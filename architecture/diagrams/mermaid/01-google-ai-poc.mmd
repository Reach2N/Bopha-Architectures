%% Bopha - Current Google AI Architecture (PoC - Week 1)
%% Shows the working proof-of-concept using Google APIs

graph TB
    subgraph "Frontend Layer"
        style FrontendLayer fill:#3B82F6,color:#fff
        Web["Next.js 15 App<br/>React 19<br/>TypeScript"]
        T2V["T2V Studio<br/>(3-panel layout)"]
        V2V["V2V Voice Chat<br/>(real-time)"]
        Library["Library Browser<br/>(workspaces)"]
        Web --> T2V
        Web --> V2V
        Web --> Library
    end

    subgraph "Middleware"
        style Middleware fill:#10B981,color:#fff
        MW["middleware.ts<br/>Route Protection<br/>Session Validation"]
    end

    subgraph "API Routes Layer"
        style APILayer fill:#10B981,color:#fff
        GenAPI["/api/generate<br/>âš¡ Content Pipeline"]
        UploadAPI["/api/upload<br/>ğŸ’¾ File Handler"]
        AudioAPI["/api/audio/*<br/>ğŸ¤ Audio Save/Get"]
        LibAPI["/api/library/*<br/>ğŸ“š CRUD + Sync"]
        AuthAPI["/api/auth/*<br/>ğŸ” Better Auth"]
    end

    subgraph "Service Layer"
        style ServiceLayer fill:#10B981,color:#fff
        GPS["GenPodcastService<br/>âš™ï¸ Pipeline Orchestration"]
        FUS["FileUploadService<br/>ğŸ“¤ File Processing"]
        CS["conversationService<br/>ğŸ™ï¸ TTS Generation"]
        GLS["geminiLiveServer<br/>ğŸ”´ Real-time Voice"]
        CPH["contentPartsHelper<br/>ğŸ“‹ Document Prep"]
    end

    subgraph "Google Gemini AI (External)"
        style GeminiLayer fill:#F59E0B,color:#fff
        G25FL["Gemini 2.5 Flash Lite<br/>ğŸ§  Outline (5-10s)<br/>$0.002/req"]
        G25F["Gemini 2.5 Flash<br/>ğŸ§  Script (15-30s)<br/>$0.015/req"]
        G25TTS["Gemini 2.5 Pro-TTS<br/>ğŸ¤ Audio (20-40s)<br/>$0.028/req<br/>Voices: Zephyr + Charon"]
        GFILE["Gemini File API<br/>ğŸ’¾ Auto-split >45MB<br/>48hr cache"]
        GLIVE["Gemini Live Audio<br/>ğŸ”´ Voice Chat (WebSocket)<br/>180ms latency<br/>Voice: Kore"]
        GTOOLS["Tools:<br/>ğŸ” urlContext<br/>ğŸŒ googleSearch"]
    end

    subgraph "Database (Supabase)"
        style Database fill:#6366F1,color:#fff
        PG["PostgreSQL<br/>via Prisma ORM"]
        USER["ğŸ‘¤ User<br/>(email, role)"]
        LIB["ğŸ“š Library<br/>(name, data JSON)"]
        SESS["ğŸ”‘ Session<br/>(token, expiresAt)"]
        PG --> USER
        PG --> LIB
        PG --> SESS
    end

    subgraph "Local Storage"
        style Storage fill:#6B7280,color:#fff
        LOCAL["/generated-audio/<br/>ğŸ’¾ WAV files"]
    end

    %% User Flow
    Web --> MW
    MW --> GenAPI
    MW --> UploadAPI
    MW --> AudioAPI
    MW --> LibAPI
    MW --> AuthAPI

    %% Generation Pipeline
    GenAPI --> GPS
    GPS --> CPH
    CPH --> GFILE
    CPH --> G25FL
    G25FL --> G25F
    G25F --> CS
    CS --> G25TTS
    G25TTS --> AudioAPI
    AudioAPI --> LOCAL
    GenAPI --> PG

    %% File Upload
    UploadAPI --> FUS
    FUS --> GFILE
    GFILE --> PG

    %% Voice Chat
    V2V --> GLS
    GLS -.WebSocket.-> GLIVE

    %% Library
    LibAPI --> PG

    %% Auth
    AuthAPI --> PG

    %% Tools
    G25FL -.uses.-> GTOOLS
    G25F -.uses.-> GTOOLS

    %% Annotations
    classDef frontend fill:#3B82F6,stroke:#2563EB,color:#fff
    classDef api fill:#10B981,stroke:#059669,color:#fff
    classDef google fill:#F59E0B,stroke:#D97706,color:#fff
    classDef db fill:#6366F1,stroke:#4F46E5,color:#fff
    classDef storage fill:#6B7280,stroke:#4B5563,color:#fff

    class Web,T2V,V2V,Library frontend
    class GenAPI,UploadAPI,AudioAPI,LibAPI,AuthAPI,GPS,FUS,CS,GLS,CPH api
    class G25FL,G25F,G25TTS,GFILE,GLIVE,GTOOLS google
    class PG,USER,LIB,SESS db
    class LOCAL storage

    %% Legend
    subgraph "ğŸ“Š Current Status"
        STATUS["âœ… PoC Complete<br/>âœ… Teacher Approved<br/>ğŸ“… Week 1: Data Collection Phase<br/>ğŸ’° Cost: ~$0.045/generation<br/>â±ï¸ Total Time: 45-80s"]
    end

